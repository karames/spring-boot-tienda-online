<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico de Login - Tienda Online</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- Los estilos est√°n ahora en el archivo CSS principal -->
</head>

<body>
    <nav class="main-nav">
        <div class="nav-center">
            <a href="/" id="inicio-link">üè† Inicio</a>
            <a href="productos.html" id="productos-link" style="display:none;">üì¶ Productos</a>
            <a href="pedidos.html" id="pedidos-link" style="display:none;">üìã Mis pedidos</a>
            <a href="admin.html" id="admin-link" style="display:none;">‚öôÔ∏è Admin</a>
            <a href="documentacion.html" id="docs-link">üìö Documentaci√≥n</a>
            <a href="login.html" id="login-link">üîê Iniciar sesi√≥n</a>
            <a href="register.html" id="register-link">üìù Registrarse</a>
        </div>
        <div id="user-menu" class="user-menu" style="display:none;">
            <button id="user-menu-btn" class="user-menu-btn">
                <span id="user-info"></span>
                <span style="margin-left:0.4em;">‚ñº</span>
            </button>
            <div id="user-menu-dropdown" class="user-menu-dropdown" style="display:none;">
                <button onclick="logout()">Cerrar sesi√≥n</button>
            </div>
        </div>
    </nav>

    <div class="welcome-container">
        <header class="welcome-header">
            <h1>üîç Diagn√≥stico de Login</h1>
            <p>Herramienta para diagnosticar problemas con el inicio de sesi√≥n</p>
        </header>
    </div>

    <div class="diagnostico-container">
        <div class="alert alert-info">
            <strong>Nota:</strong> Esta herramienta es solo para fines de diagn√≥stico. No para uso en producci√≥n.
        </div>

        <h2>Verificar Usuario</h2>
        <div class="form-group">
            <label for="username">Nombre de usuario:</label>
            <input type="text" id="username" value="admin">
        </div>
        <button id="verify-user-btn" class="btn-diagnostico">Verificar Usuario</button>

        <div id="user-result" class="resultado" style="display: none;">
            <h3>Resultado:</h3>
            <pre id="user-data"></pre>
        </div>

        <h2>Verificar Contrase√±a</h2>
        <div class="form-group">
            <label for="username-pwd">Nombre de usuario:</label>
            <input type="text" id="username-pwd" value="admin">
        </div>
        <div class="form-group">
            <label for="password">Contrase√±a:</label>
            <input type="password" id="password" value="admin">
        </div>
        <button id="verify-pwd-btn" class="btn-diagnostico">Verificar Contrase√±a</button>

        <div id="pwd-result" class="resultado" style="display: none;">
            <h3>Resultado:</h3>
            <pre id="pwd-data"></pre>
        </div>

        <h2>Probar Login</h2>
        <div class="form-group">
            <label for="login-username">Nombre de usuario:</label>
            <input type="text" id="login-username" value="admin">
        </div>
        <div class="form-group">
            <label for="login-password">Contrase√±a:</label>
            <input type="password" id="login-password" value="admin">
        </div>
        <button id="login-btn" class="btn-diagnostico">Probar Login</button>

        <div id="login-result" class="resultado" style="display: none;">
            <h3>Resultado:</h3>
            <pre id="login-data"></pre>
        </div>

        <p style="margin-top: 30px; text-align: center;">
            <a href="/">Volver a la p√°gina principal</a>
        </p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar usuario
            document.getElementById('verify-user-btn').addEventListener('click', async () => {
                const username = document.getElementById('username').value;
                try {
                    const response = await fetch(`/dev/diagnostico/usuario/${username}`);
                    const data = await response.json();
                    document.getElementById('user-data').textContent = JSON.stringify(data, null, 2);
                    document.getElementById('user-result').style.display = 'block';
                } catch (error) {
                    document.getElementById('user-data').textContent = `Error: ${error.message}`;
                    document.getElementById('user-result').style.display = 'block';
                }
            });

            // Verificar contrase√±a
            document.getElementById('verify-pwd-btn').addEventListener('click', async () => {
                const username = document.getElementById('username-pwd').value;
                const password = document.getElementById('password').value;
                try {
                    const response = await fetch(`/dev/diagnostico/password/verify/${username}/${password}`);
                    const data = await response.json();
                    document.getElementById('pwd-data').textContent = JSON.stringify(data, null, 2);
                    document.getElementById('pwd-result').style.display = 'block';
                } catch (error) {
                    document.getElementById('pwd-data').textContent = `Error: ${error.message}`;
                    document.getElementById('pwd-result').style.display = 'block';
                }
            });

            // Probar login
            document.getElementById('login-btn').addEventListener('click', async () => {
                const username = document.getElementById('login-username').value;
                const password = document.getElementById('login-password').value;
                try {
                    const response = await fetch('/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });

                    let resultText = '';
                    if (response.ok) {
                        const data = await response.json();
                        resultText = `Login exitoso!\n\nToken: ${data.token.substring(0, 20)}...\nUsername: ${data.username}\nRole: ${data.role}`;
                    } else {
                        try {
                            const errorData = await response.json();
                            resultText = `Error ${response.status}: ${errorData.message || response.statusText}`;
                        } catch (e) {
                            resultText = `Error ${response.status}: ${response.statusText}`;
                        }
                    }

                    document.getElementById('login-data').textContent = resultText;
                    document.getElementById('login-result').style.display = 'block';
                } catch (error) {
                    document.getElementById('login-data').textContent = `Error: ${error.message}`;
                    document.getElementById('login-result').style.display = 'block';
                }
            });
        });
    </script>
</body>

</html>
